<div class="tutor-layout">
  <!-- Sidebar simple -->
  <aside class="sidebar">
    <div class="brand">
      <span class="logo">myTEACHER</span>
    </div>

    <nav class="menu">
      <a routerLink="/tutor/dashboard" routerLinkActive="active">Inicio</a>
      <a routerLink="/tutor/calendar" routerLinkActive="active">Calendario</a>
      <a routerLink="/tutor/profile" routerLinkActive="active">Perfil</a>
    </nav>

    <div class="sidebar-bottom">
      <button class="link" (click)="logout()">Cerrar Sesión</button>
    </div>
  </aside>

  <!-- Contenido principal -->
  <div class="tutor-main">
    <header class="page-header">
      <h1>Panel de Control del Tutor</h1>
      <p class="subtitle">
        Gestiona tus ofertas, controla tus clases y recibe notificaciones de tus estudiantes.
      </p>
    </header>

    <main class="page-content">
      <!-- Resumen -->
      <section class="stats-row">
        <div class="stat-card">
          <div class="stat-label">Ofertas activas</div>
          <div class="stat-value">{{ ofertas.length }}</div>
          <div class="stat-subtext">
            Publicadas por ti
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Horas reservadas</div>
          <div class="stat-value">{{ totalHorasReservadas }}</div>
          <div class="stat-subtext">
            Suma de las reservas actuales
          </div>
        </div>
      </section>

      <!-- Crear oferta -->
      <section class="card card-offer-form">
        <div class="card-header">
          <h2>Crear nueva oferta</h2>
          <p class="muted">Define la materia, modalidad, precio por hora y número de horas.</p>
        </div>

        <form class="offer-form" (ngSubmit)="publicarOferta()">
          <div class="form-row">
            <div class="form-control">
              <label>Materia</label>
              <input
                type="text"
                [(ngModel)]="nueva.subject"
                name="subject"
                placeholder="Ej: Cálculo diferencial"
              />
            </div>

            <div class="form-control">
              <label>Modalidad</label>
              <select [(ngModel)]="nueva.mode" name="mode">
                <option value="Virtual">Virtual</option>
                <option value="Presencial">Presencial</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-control">
              <label>Precio por hora (COP)</label>
              <input
                type="number"
                [(ngModel)]="nueva.pricePerHour"
                name="pricePerHour"
                min="0"
              />
            </div>

            <div class="form-control">
              <label>Horas</label>
              <input
                type="number"
                [(ngModel)]="nueva.hours"
                name="hours"
                min="1"
                max="10"
              />
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn primary">
              Publicar oferta
            </button>
          </div>
        </form>
      </section>

      <!-- Tabla de ofertas -->
      <section class="card card-offers-table">
        <div class="card-header">
          <div>
            <h2>Mis ofertas</h2>
            <p class="muted">Administra tus clases publicadas.</p>
          </div>

          <div class="filters">
            <label class="filter-label">
              Filtro:
              <select [(ngModel)]="filtro" class="filter-select">
                <option value="Todos">Todas</option>
                <option value="Disponible">Disponibles</option>
                <option value="Reservada">Reservadas</option>
                <option value="Pagada">Pagadas</option>
                <option value="Cerrada">Cerradas</option>
              </select>
            </label>
          </div>
        </div>

        <div class="table-wrapper">
          <table class="table">
            <thead>
            <tr>
              <th>Materia</th>
              <th>Modalidad</th>
              <th>$ / h</th>
              <th>Horas</th>
              <th>Estado</th>
              <th>Estudiante</th>
              <th class="text-right">Acción</th>
            </tr>
            </thead>

            <tbody>
            <tr *ngFor="let o of getClasesFiltradas()">
              <td><strong>{{ o.subject }}</strong></td>
              <td>{{ o.mode }}</td>
              <td>{{ o.pricePerHour | number }}</td>
              <td>{{ o.hours }}</td>
              <td>
              <span
                class="chip"
                [class.available]="o.status === 'Disponible'"
                [class.reserved]="o.status === 'Reservada'"
                [class.done]="o.status === 'Pagada'"
                [class.closed]="o.status === 'Cerrada'"
              >
                {{ o.status }}
              </span>
              </td>
              <td>{{ o.takenByStudentName || '—' }}</td>
              <td class="text-right">
                <button
                  class="btn primary"
                  [disabled]="o.status !== 'Reservada'"
                  (click)="iniciar(o)"
                >
                  Iniciar
                </button>
              </td>
            </tr>

            <tr *ngIf="getClasesFiltradas().length === 0">
              <td colspan="7" class="empty">
                Aún no has publicado ofertas para este filtro.
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Notificaciones -->
      <section class="card card-notifications">
        <div class="card-header">
          <h2>Notificaciones</h2>
        </div>

        <ng-container *ngIf="inbox && inbox.length; else noNotif">
          <ul class="inbox-list">
            <li class="inbox-item" *ngFor="let n of inbox">
              <div class="inbox-main">
                <div class="inbox-title">{{ n.title || n.titulo }}</div>
                <div class="inbox-body">
                  {{ n.body || n.mensaje }}
                </div>
              </div>
              <div class="inbox-meta">
                {{ (n.date || n.fecha) | date:'short' }}
              </div>
            </li>
          </ul>
        </ng-container>

        <ng-template #noNotif>
          <div class="empty">Sin notificaciones.</div>
        </ng-template>
      </section>
    </main>
  </div>
</div>
